#- name: magento | check if installed
#  stat: >
#    path=/usr/local/bin/n98-magerun.phar
#  register: magento_installed

- name: install
  shell: >
    n98-magerun.phar install \
      --dbHost="{{ item.dbHost|default('localhost') }}" \
      --dbUser="{{ item.dbUser|default('user') }}" \
      --dbPass="{{ item.dbPassword|default('user') }}" \
      --dbName="{{ item.db|default('app') }}" \
      --installSampleData="{{ item.installSampleData|default('yes') }}" \
      --useDefaultConfigParams="{{ item.useDefaultConfigParams|default('yes') }}" \
      --magentoVersionByName="{{ item.version }}" \
      --installationFolder="{{ item.installationFolder|default('magento') }}" \
      --baseUrl="{{ item.installationFolder|default('http://magento.vagrant-local.de') }}"
    chdir={{ item.path }}/
  with_items: applications.magento
  when: n98magerun_installed.stat.exists
#  when: n98magerun_installed.stat.exists and not magento_installed.stat.exists

